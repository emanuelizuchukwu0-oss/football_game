<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Football Challenge</title>
    <style>
        /* YOUR EXISTING CSS - KEEP ALL YOUR ORIGINAL STYLES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
            position: fixed;
            width: 100vw;
            height: 100vh;
        }

        #orientationMessage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
            text-align: center;
            padding: 20px;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            max-width: 100%;
            max-height: 100%;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        canvas {
            background: #27ae60;
            display: block;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            z-index: 100;
            padding: 15px;
            pointer-events: auto;
        }

        .btn {
            padding: 8px 16px;
            margin: 4px;
            font-size: 0.85rem;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            min-width: 100px;
            min-height: 44px;
        }

        /* ... KEEP ALL YOUR ORIGINAL CSS STYLES ... */

    </style>
</head>
<body>
    <div id="orientationMessage">
        <h1>Please Rotate Your Device</h1>
        <p>This game works best in landscape mode. Please rotate your device to continue.</p>
        <div style="font-size: 2.5rem; margin: 15px;">â†»</div>
    </div>

    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <button id="pauseBtn" class="btn btn-pause" style="display: none;">PAUSE</button>
        <button id="soundBtn" class="btn btn-sound" style="display: none;">ðŸ”‡ SOUND</button>
        
        <div id="uiContainer">
            <div class="ui-box">
                <span>Lives:</span>
                <div class="lives">
                    <div class="life"></div><div class="life"></div><div class="life"></div>
                    <div class="life"></div><div class="life"></div><div class="life"></div>
                    <div class="life"></div>
                </div>
            </div>
            <div class="ui-box">
                <span>Chapter: <span id="chapterDisplay">1</span></span>
            </div>
            <div class="ui-box">
                <span>Opponents: <span id="opponentsDisplay">1</span></span>
            </div>
            <div class="ui-box" id="timerContainer">
                <span>Recovery: <span id="recoveryTimer">5</span>s</span>
            </div>
        </div>
        
        <div id="mobileControls">
            <div class="joystick-container">
                <div class="joystick-base">
                    <div class="joystick-handle"></div>
                </div>
            </div>
            <div class="action-buttons">
                <div class="control-btn shoot">SHOOT</div>
                <div class="control-btn steal">STEAL</div>
                <div class="control-btn fight">FIGHT</div>
            </div>
        </div>
        
        <div id="startOverlay" class="overlay">
            <h1>FOOTBALL CHALLENGE</h1>
            <p>Score against increasingly more opponents! Start with 1 opponent, then 2, 3, and so on up to 22!</p>
            <p>Use arrow keys to move, 'S' to steal, SPACE to shoot, and 'F' to fight. Press 'P' to pause.</p>
            <div class="btn-container">
                <button id="startBtn" class="btn">START GAME</button>
            </div>
        </div>
        
        <div id="pauseOverlay" class="overlay" style="display: none;">
            <h1>GAME PAUSED</h1>
            <p>Take a break and get ready for the next challenge!</p>
            <div class="btn-container">
                <button id="resumeBtn" class="btn">RESUME GAME</button>
            </div>
        </div>
        
        <div id="winOverlay" class="overlay" style="display: none;">
            <h1>LEVEL COMPLETE!</h1>
            <h2>You scored against <span id="winOpponents">1</span> opponents!</h2>
            <div class="btn-container">
                <button id="replayBtn" class="btn">PLAY AGAIN</button>
                <button id="nextChapterBtn" class="btn btn-secondary">NEXT CHAPTER</button>
            </div>
        </div>
        
        <div id="loseOverlay" class="overlay" style="display: none;">
            <h1>GAME OVER</h1>
            <h2>You lost on Chapter <span id="loseChapter">1</span></h2>
            <p>You couldn't score against <span id="loseOpponents">1</span> opponents!</p>
            <div class="btn-container">
                <button id="restartBtn" class="btn">PLAY AGAIN</button>
            </div>
        </div>
    </div>

    <!-- Sound effects -->
    <audio id="backgroundMusic" loop><source src="#" type="audio/mpeg"></audio>
    <audio id="loseSound"><source src="#" type="audio/mpeg"></audio>
    <audio id="winSound"><source src="#" type="audio/mpeg"></audio>
    <audio id="kickSound"><source src="#" type="audio/mpeg"></audio>
    <audio id="goalSound"><source src="#" type="audio/mpeg"></audio>
    <audio id="cannonSound"><source src="#" type="audio/mpeg"></audio>
    <audio id="hitSound"><source src="#" type="audio/mpeg"></audio>
    <audio id="stealSound"><source src="#" type="audio/mpeg"></audio>
    <audio id="walkSound" loop><source src="#" type="audio/mpeg"></audio>

<script>
// ===== GAME CONFIGURATION =====
const CONFIG = {
    LIVES: 7,
    RECOVERY_TIME: 5,
    CHAPTERS: 22,
    PLAYER_SPEED: 4,
    OPPONENT_SPEED: 2.2,
    BALL_SPEED: 8,
    GOALKEEPER_SPEED: 3,
    GOAL_HEIGHT: 180,
    CANNON_SPEED: 6,
    CANNON_COOLDOWN: 120,
    FIGHT_COOLDOWN: 30,
    FIGHT_RANGE: 40,
    FIGHT_KNOCKBACK: 8
};

// ===== GAME STATE =====
let game = {
    canvas: null,
    ctx: null,
    player: null,
    opponents: [],
    goalkeeper: null,
    ball: null,
    cannons: [],
    cannonBalls: [],
    lives: CONFIG.LIVES,
    chapter: 1,
    recoveryTimer: CONFIG.RECOVERY_TIME,
    ballLost: false,
    gameStarted: false,
    isMobile: false,
    lastTime: 0,
    animationId: null,
    paused: false,
    screenType: 'mobile'
};

// ===== SIMPLIFIED BUTTON HANDLERS =====
function setupButtonHandlers() {
    console.log("Setting up button handlers...");
    
    // Start button
    const startBtn = document.getElementById('startBtn');
    if (startBtn) {
        startBtn.addEventListener('click', startGame);
        console.log("Start button handler attached");
    }

    // Other buttons
    document.getElementById('pauseBtn')?.addEventListener('click', togglePause);
    document.getElementById('resumeBtn')?.addEventListener('click', togglePause);
    document.getElementById('replayBtn')?.addEventListener('click', replayChapter);
    document.getElementById('nextChapterBtn')?.addEventListener('click', nextChapter);
    document.getElementById('restartBtn')?.addEventListener('click', restartGame);
}

// ===== CORE GAME FUNCTIONS =====
function init() {
    console.log("Game initialization started...");
    
    // Get canvas and context
    game.canvas = document.getElementById('gameCanvas');
    if (!game.canvas) {
        console.error("Canvas element not found!");
        setTimeout(init, 100);
        return;
    }
    
    game.ctx = game.canvas.getContext('2d');
    setupCanvas();
    
    // Device detection
    game.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    if (game.isMobile) {
        document.getElementById('mobileControls').style.display = 'flex';
        setupMobileControls();
    } else {
        setupKeyboardControls();
    }
    
    setupButtonHandlers();
    window.addEventListener('resize', handleResize);
    
    resetGame();
    game.animationId = requestAnimationFrame(gameLoop);
    console.log("Game initialization completed!");
}

function setupCanvas() {
    if (!game.canvas) return;
    game.canvas.width = window.innerWidth;
    game.canvas.height = window.innerHeight;
}

function handleResize() {
    setupCanvas();
    if (game.gameStarted) {
        resetGame();
    }
}

function setupKeyboardControls() {
    document.addEventListener('keydown', (e) => {
        if (!game.gameStarted || game.paused) return;
        
        switch(e.key) {
            case 'ArrowUp': game.player.moveUp = true; break;
            case 'ArrowDown': game.player.moveDown = true; break;
            case 'ArrowLeft': game.player.moveLeft = true; break;
            case 'ArrowRight': game.player.moveRight = true; break;
            case ' ': game.player.shoot(); break;
            case 's': game.player.steal(); break;
            case 'f': game.player.fight(); break;
            case 'p': togglePause(); break;
        }
    });
    
    document.addEventListener('keyup', (e) => {
        switch(e.key) {
            case 'ArrowUp': game.player.moveUp = false; break;
            case 'ArrowDown': game.player.moveDown = false; break;
            case 'ArrowLeft': game.player.moveLeft = false; break;
            case 'ArrowRight': game.player.moveRight = false; break;
        }
    });
}

function setupMobileControls() {
    const joystickBase = document.querySelector('.joystick-base');
    const shootBtn = document.querySelector('.control-btn.shoot');
    
    if (!joystickBase || !shootBtn) return;
    
    let joystickActive = false;
    let joystickCenter = { x: 0, y: 0 };
    const maxDistance = 30;
    
    function updateJoystickCenter() {
        const rect = joystickBase.getBoundingClientRect();
        joystickCenter = { x: rect.left + rect.width/2, y: rect.top + rect.height/2 };
    }
    
    joystickBase.addEventListener('touchstart', (e) => {
        if (game.paused) return;
        joystickActive = true;
        updateJoystickCenter();
        handleJoystickMove(e);
    });
    
    document.addEventListener('touchmove', (e) => {
        if (!joystickActive || !game.gameStarted || game.paused) return;
        handleJoystickMove(e);
    });
    
    document.addEventListener('touchend', () => {
        joystickActive = false;
        game.player.moveUp = game.player.moveDown = game.player.moveLeft = game.player.moveRight = false;
    });
    
    [shootBtn, document.querySelector('.control-btn.steal'), document.querySelector('.control-btn.fight')].forEach(btn => {
        if (btn) {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!game.paused) {
                    if (btn.classList.contains('shoot')) game.player.shoot();
                    else if (btn.classList.contains('steal')) game.player.steal();
                    else if (btn.classList.contains('fight')) game.player.fight();
                }
            });
        }
    });
    
    function handleJoystickMove(e) {
        const touch = e.touches[0];
        const deltaX = touch.clientX - joystickCenter.x;
        const deltaY = touch.clientY - joystickCenter.y;
        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
        const angle = Math.atan2(deltaY, deltaX);
        const limitedDistance = Math.min(distance, maxDistance);
        
        const moveX = Math.cos(angle) * (limitedDistance / maxDistance);
        const moveY = Math.sin(angle) * (limitedDistance / maxDistance);
        
        const sensitivity = 0.4;
        game.player.moveUp = moveY < -sensitivity;
        game.player.moveDown = moveY > sensitivity;
        game.player.moveLeft = moveX < -sensitivity;
        game.player.moveRight = moveX > sensitivity;
    }
    
    updateJoystickCenter();
}

// ===== GAME CONTROL FUNCTIONS =====
function startGame() {
    console.log("Starting game...");
    document.getElementById('startOverlay').style.display = 'none';
    document.getElementById('pauseBtn').style.display = 'block';
    game.gameStarted = true;
}

function togglePause() {
    game.paused = !game.paused;
    if (game.paused) {
        document.getElementById('pauseOverlay').style.display = 'flex';
        document.getElementById('pauseBtn').textContent = 'RESUME';
    } else {
        document.getElementById('pauseOverlay').style.display = 'none';
        document.getElementById('pauseBtn').textContent = 'PAUSE';
    }
}

function replayChapter() {
    document.getElementById('winOverlay').style.display = 'none';
    resetGame();
    game.gameStarted = true;
}

function nextChapter() {
    document.getElementById('winOverlay').style.display = 'none';
    game.chapter = Math.min(game.chapter + 1, CONFIG.CHAPTERS);
    resetGame();
    game.gameStarted = true;
}

function restartGame() {
    document.getElementById('loseOverlay').style.display = 'none';
    game.chapter = 1;
    resetGame();
    game.gameStarted = true;
}

// ===== PLAYER CLASS =====
class Player {
    constructor(x, y, isUser = false, isGoalkeeper = false) {
        this.x = x;
        this.y = y;
        this.radius = isGoalkeeper ? 15 : 18;
        this.speed = isUser ? CONFIG.PLAYER_SPEED : (isGoalkeeper ? CONFIG.GOALKEEPER_SPEED : CONFIG.OPPONENT_SPEED);
        this.isUser = isUser;
        this.isGoalkeeper = isGoalkeeper;
        this.color = isUser ? '#3498db' : (isGoalkeeper ? '#9b59b6' : '#e74c3c');
        this.hasBall = isUser;
        
        this.moveUp = this.moveDown = this.moveLeft = this.moveRight = false;
        this.kicking = false;
        this.kickFrame = 0;
        this.fighting = false;
        this.fightFrame = 0;
        this.fightCooldown = 0;
    }

    update() {
        if (this.fightCooldown > 0) this.fightCooldown--;
        
        if (this.isUser) {
            let moveX = 0, moveY = 0;
            if (this.moveUp) moveY -= 1;
            if (this.moveDown) moveY += 1;
            if (this.moveLeft) moveX -= 1;
            if (this.moveRight) moveX += 1;
            
            if (moveX !== 0 && moveY !== 0) {
                moveX *= 0.707;
                moveY *= 0.707;
            }
            
            this.x += moveX * this.speed;
            this.y += moveY * this.speed;
        }
        
        // Boundary checks
        this.x = Math.max(this.radius, Math.min(game.canvas.width - this.radius, this.x));
        this.y = Math.max(this.radius, Math.min(game.canvas.height - this.radius, this.y));
        
        if (this.hasBall && game.ball.possessedBy === this) {
            game.ball.x = this.x + (this.isUser ? 25 : -25);
            game.ball.y = this.y;
        }
        
        if (this.kicking) {
            this.kickFrame++;
            if (this.kickFrame > 8) this.kicking = false;
        }
        
        if (this.fighting) {
            this.fightFrame++;
            if (this.fightFrame > 10) this.fighting = false;
        }
    }

    draw(ctx) {
        ctx.save();
        ctx.translate(this.x, this.y);
        
        // Body
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
        ctx.fill();
        
        if (this.isUser) {
            ctx.strokeStyle = '#f1c40f';
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        // Ball indicator
        if (this.hasBall) {
            ctx.fillStyle = '#f1c40f';
            ctx.beginPath();
            ctx.arc(this.isUser ? 20 : -20, 0, 5, 0, Math.PI * 2);
            ctx.fill();
        }
        
        ctx.restore();
    }

    shoot() {
        if (this.hasBall && this.isUser) {
            const goalX = game.canvas.width;
            const goalY = game.canvas.height / 2;
            const dx = goalX - this.x;
            const dy = goalY - this.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            game.ball.speedX = (dx / distance) * CONFIG.BALL_SPEED;
            game.ball.speedY = (dy / distance) * CONFIG.BALL_SPEED;
            game.ball.possessedBy = null;
            this.hasBall = false;
            this.kicking = true;
        }
    }

    steal() {
        if (!this.hasBall && this.isUser) {
            if (game.ball.possessedBy && !game.ball.possessedBy.isUser) {
                const dx = game.ball.possessedBy.x - this.x;
                const dy = game.ball.possessedBy.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 40 && Math.random() < 0.5) {
                    game.ball.possessedBy.hasBall = false;
                    game.ball.possessedBy = this;
                    this.hasBall = true;
                }
            }
        }
    }

    fight() {
        if (this.isUser && this.fightCooldown === 0) {
            this.fighting = true;
            this.fightFrame = 0;
            this.fightCooldown = CONFIG.FIGHT_COOLDOWN;
        }
    }
}

// ===== BALL CLASS =====
class Ball {
    constructor() {
        this.x = 80;
        this.y = game.canvas.height / 2;
        this.radius = 8;
        this.speedX = 0;
        this.speedY = 0;
        this.possessedBy = game.player;
        this.rotation = 0;
    }

    update() {
        this.speedX *= 0.96;
        this.speedY *= 0.96;
        this.x += this.speedX;
        this.y += this.speedY;
        this.rotation += this.speedX * 0.08;
        
        // Boundary collision
        if (this.x - this.radius < 0 || this.x + this.radius > game.canvas.width) {
            this.speedX *= -0.6;
        }
        if (this.y - this.radius < 0 || this.y + this.radius > game.canvas.height) {
            this.speedY *= -0.6;
        }
        
        this.x = Math.max(this.radius, Math.min(game.canvas.width - this.radius, this.x));
        this.y = Math.max(this.radius, Math.min(game.canvas.height - this.radius, this.y));
        
        // Goal detection
        if (this.x > game.canvas.width - 25 && 
            Math.abs(this.y - game.canvas.height/2) < CONFIG.GOAL_HEIGHT/2) {
            showWinOverlay();
        }
    }

    draw(ctx) {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        
        ctx.fillStyle = '#FFFFFF';
        ctx.beginPath();
        ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.strokeStyle = '#000000';
        ctx.lineWidth = 1;
        ctx.stroke();
        
        ctx.restore();
    }
}

// ===== GAME LOGIC =====
function resetGame() {
    console.log("Resetting game...");
    
    // Create player
    game.player = new Player(80, game.canvas.height / 2, true);
    
    // Create goalkeeper
    game.goalkeeper = new Player(game.canvas.width - 30, game.canvas.height / 2, false, true);
    
    // Create opponents
    game.opponents = [];
    for (let i = 0; i < game.chapter; i++) {
        const x = game.canvas.width - 150 - (i % 3) * 50;
        const y = 60 + Math.floor(i / 3) * 50;
        game.opponents.push(new Player(x, y, false));
    }
    
    // Create ball
    game.ball = new Ball();
    
    // Reset game state
    game.lives = CONFIG.LIVES;
    game.recoveryTimer = CONFIG.RECOVERY_TIME;
    game.ballLost = false;
    game.paused = false;
    
    updateLivesDisplay();
    updateChapterDisplay();
}

function gameLoop(timestamp) {
    const deltaTime = timestamp - game.lastTime;
    game.lastTime = timestamp;
    
    if (game.gameStarted && !game.paused) {
        update(deltaTime);
    }
    
    render();
    game.animationId = requestAnimationFrame(gameLoop);
}

function update(deltaTime) {
    if (!game.player) return;
    
    game.player.update();
    game.opponents.forEach(opponent => opponent.update());
    game.goalkeeper.update();
    game.ball.update();
}

function render() {
    if (!game.ctx || !game.canvas) return;
    
    const ctx = game.ctx;
    ctx.clearRect(0, 0, game.canvas.width, game.canvas.height);
    
    // Draw field
    ctx.fillStyle = '#27ae60';
    ctx.fillRect(0, 0, game.canvas.width, game.canvas.height);
    
    // Draw goals
    ctx.strokeStyle = '#ffffff';
    ctx.lineWidth = 2;
    ctx.strokeRect(0, game.canvas.height/2 - CONFIG.GOAL_HEIGHT/2, 25, CONFIG.GOAL_HEIGHT);
    ctx.strokeRect(game.canvas.width - 25, game.canvas.height/2 - CONFIG.GOAL_HEIGHT/2, 25, CONFIG.GOAL_HEIGHT);
    
    // Draw players and ball
    game.opponents.forEach(opponent => opponent.draw(ctx));
    game.goalkeeper.draw(ctx);
    game.player.draw(ctx);
    game.ball.draw(ctx);
    
    // Draw center line
    ctx.beginPath();
    ctx.moveTo(game.canvas.width/2, 0);
    ctx.lineTo(game.canvas.width/2, game.canvas.height);
    ctx.stroke();
}

function updateLivesDisplay() {
    const lives = document.querySelectorAll('.life');
    lives.forEach((life, index) => {
        life.classList.toggle('lost', index >= game.lives);
    });
}

function updateChapterDisplay() {
    document.getElementById('chapterDisplay').textContent = game.chapter;
    document.getElementById('opponentsDisplay').textContent = game.chapter;
}

function showWinOverlay() {
    document.getElementById('winOpponents').textContent = game.chapter;
    document.getElementById('winOverlay').style.display = 'flex';
    game.gameStarted = false;
    document.getElementById('pauseBtn').style.display = 'none';
}

function showLoseOverlay() {
    document.getElementById('loseChapter').textContent = game.chapter;
    document.getElementById('loseOpponents').textContent = game.chapter;
    document.getElementById('loseOverlay').style.display = 'flex';
    game.gameStarted = false;
    document.getElementById('pauseBtn').style.display = 'none';
}

// ===== INITIALIZATION =====
window.addEventListener('load', function() {
    console.log("Window loaded, initializing game...");
    setTimeout(init, 100);
});

window.addEventListener('error', function(e) {
    console.error('Game error:', e.error);
});
</script>

<!-- Hybrid components container -->
<div id="hybrid-components"></div>
</body>
</html>